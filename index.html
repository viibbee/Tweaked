
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Push Tweak to GitHub</title>
  <style>
    body { font-family: sans-serif; padding: 2em; max-width: 800px; margin: auto; }
    textarea { width: 100%; height: 300px; margin-bottom: 1em; }
    input, button { padding: 0.5em; font-size: 1em; margin-bottom: 1em; width: 100%; }
    .status { margin-top: 1em; font-weight: bold; }
  </style>
</head>
<body>
  <h1>Push Tweak.xm to GitHub</h1>
  <label>GitHub Token:</label><br>
  <input id="token" type="password" placeholder="ghp_..." /><br>

  <label>–§–∞–π–ª (–Ω–∞–ø—Ä–∏–º–µ—Ä, Tweak.xm):</label><br>
  <input id="filename" type="text" value="Tweak.xm" /><br>

  <label>–ö–æ–¥ —Ç–≤–∏–∫–∞:</label><br>
  <textarea id="code"></textarea><br>

  <button onclick="pushToGitHub()">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π</button>

  <div class="status" id="status"></div>

  <script>
    async function pushToGitHub() {
      const token = document.getElementById("token").value;
      const filename = document.getElementById("filename").value;
      const code = document.getElementById("code").value;
      const statusEl = document.getElementById("status");

      const repo = "viibbee/Tweaked";
      const branch = "main";

      statusEl.textContent = "üì¶ –ü–æ–ª—É—á–∞—é sha —Ç–µ–∫—É—â–µ–≥–æ —Ñ–∞–π–ª–∞...";

      const resGet = await fetch(`https://api.github.com/repos/${repo}/contents/${filename}`, {
        headers: { Authorization: `token ${token}` }
      });

      let sha = undefined;
      if (resGet.ok) {
        const data = await resGet.json();
        sha = data.sha;
      }

      statusEl.textContent = "üöÄ –û—Ç–ø—Ä–∞–≤–ª—è—é —Ñ–∞–π–ª...";

      const response = await fetch(`https://api.github.com/repos/${repo}/contents/${filename}`, {
        method: "PUT",
        headers: {
          Authorization: `token ${token}`,
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          message: "Update " + filename,
          content: btoa(unescape(encodeURIComponent(code))),
          branch: branch,
          sha: sha,
        }),
      });

      if (response.ok) {
        statusEl.textContent = "‚úÖ –§–∞–π–ª —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! –ü—Ä–æ–≤–µ—Ä—å GitHub Actions —á–µ—Ä–µ–∑ –º–∏–Ω—É—Ç—É.";
      } else {
        const err = await response.json();
        statusEl.textContent = "‚ùå –û—à–∏–±–∫–∞: " + (err.message || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è");
      }
    }
  </script>
</body>
</html>
